# リポジトリ内の不要なフィあるを見るけるためのGITHUB　Actions
name: CheckUnwantedFiles
on:
# GitHubのActionsタブから手動で実行できるようにする
   workflow_dispatch:
#masterブランチへのプッシュでも実行する
   push:
     branches:
       - master




#検出する不要なファイルのパターンを定義する環境変数
#　---重要---
#プロジェクトのニーズに合わせて、これらのリストを変更してください
#パターンはスペースで区切りで指定します

env:
  # 特定のファイル名
  UNWANTED_NAME_PATTERNS: "*.pdb *.ilk *.user *.ncb *.suo *.log *.dmp *.zip imgui.ini desktop.ini dxcompiler.dll dxil.dll"
  # ディレクトリ名
  UNWANTED_DIR_PATTERNS: "generated x64 win32 arm64 .vs bin ipch logs Dump"

jobs:
  check-files:
    name: 不要なファイルを検索
    runs-on: ubuntu-latest
    steps:
      - name: リポジトリをチェックアウト
        uses: actions/checkout@v4

      - name: 不要なファイルとディレクトリを検索
        run: |
          # ディレクトリ条件を構築
          DIR_CONDITIONS=()
          for pattern in $UNWANTED_DIR_PATTERNS; do
            DIR_CONDITIONS+=(-o -iname "$pattern")
          done
          unset DIR_CONDITIONS[0]

          # ファイル条件を構築
          NAME_CONDITIONS=()
          for pattern in $UNWANTED_NAME_PATTERNS; do
            NAME_CONDITIONS+=(-o -iname "$pattern")
          done
          unset NAME_CONDITIONS[0]

          # .git を除外して検索
          UNWANTED_LIST=$(find . \
            -path "./.git" -prune -o \
            \( \( "${DIR_CONDITIONS[@]}" \) -a -type d -print -prune \) -o \
            \( \( "${NAME_CONDITIONS[@]}" \) -a -type f -print \)
          )

          if [ -n "$UNWANTED_LIST" ]; then
            echo "::error::不要なファイルまたはディレクトリが見つかりました！"
            echo "$UNWANTED_LIST"
            exit 1
          fi

          echo "リポジトリはクリーンです"